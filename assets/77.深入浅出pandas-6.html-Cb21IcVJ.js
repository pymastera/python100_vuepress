import{_ as s,c as a,a as e,o as i}from"./app-D-bq_jAa.js";const l="/assets/baidu_stock_asfreq-BYgxLzgY.png",t="/assets/baidu_stock_asfreq_ffill-_feYj08Y.png",p="/assets/baidu_stock_resample-j7qg-osx.png",d="/assets/baidu_stock_resample_agg-BEplUB4H.png",c="/assets/baidu_stock_tz_localize-Bhno6gpF.png",r="/assets/baidu_stock_tz_convert-CP0JjHWT.png",o={};function u(v,n){return i(),a("div",null,n[0]||(n[0]=[e(`<h2 id="深入浅出pandas-6" tabindex="-1"><a class="header-anchor" href="#深入浅出pandas-6"><span>深入浅出pandas-6</span></a></h2><p>我们再来看看<code>Index</code>类型，它为<code>Series</code>和<code>DataFrame</code>对象提供了索引服务，有了索引我们就可以排序数据（<code>sort_index</code>方法）、对齐数据（在运算和合并数据时非常重要）并实现对数据的快速检索（索引运算）。由于<code>DataFrame</code>类型表示的是二维数据，所以它的行和列都有索引，分别是<code>index</code>和<code>columns</code>。<code>Index</code>类型的创建的比较简单，通常给出<code>data</code>、<code>dtype</code>和<code>name</code>三个参数即可，分别表示作为索引的数据、索引的数据类型和索引的名称。由于<code>Index</code>本身也是一维的数据，索引它的方法和属性跟<code>Series</code>非常类似，你可以尝试创建一个<code>Index</code>对象，然后尝试一下之前学过的属性和方法在<code>Index</code>类型上是否生效。接下来，我们主要看看<code>Index</code>的几种子类型。</p><h3 id="范围索引" tabindex="-1"><a class="header-anchor" href="#范围索引"><span>范围索引</span></a></h3><p>范围索引是由具有单调性的整数构成的索引，我们可以通过<code>RangeIndex</code>构造器来创建范围索引，也可以通过<code>RangeIndex</code>类的类方法<code>from_range</code>来创建范围索引，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">sales_data = np.random.randint(400, 1000, 12)</span>
<span class="line">index = pd.RangeIndex(1, 13, name=&#39;月份&#39;)</span>
<span class="line">ser = pd.Series(data=sales_data, index=index)</span>
<span class="line">ser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">月份</span>
<span class="line">1     703</span>
<span class="line">2     705</span>
<span class="line">3     557</span>
<span class="line">4     943</span>
<span class="line">5     961</span>
<span class="line">6     615</span>
<span class="line">7     788</span>
<span class="line">8     985</span>
<span class="line">9     921</span>
<span class="line">10    951</span>
<span class="line">11    874</span>
<span class="line">12    609</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分类索引" tabindex="-1"><a class="header-anchor" href="#分类索引"><span>分类索引</span></a></h3><p>分类索引是由定类尺度构成的索引。如果我们需要通过索引将数据分组，然后再进行聚合操作，分类索引就可以派上用场。分类索引还有一个名为<code>reorder_categories</code>的方法，可以给索引指定一个顺序，分组聚合的结果会按照这个指定的顺序进行呈现，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">sales_data = [6, 6, 7, 6, 8, 6]</span>
<span class="line">index = pd.CategoricalIndex(</span>
<span class="line">    data=[&#39;苹果&#39;, &#39;香蕉&#39;, &#39;苹果&#39;, &#39;苹果&#39;, &#39;桃子&#39;, &#39;香蕉&#39;],</span>
<span class="line">    categories=[&#39;苹果&#39;, &#39;香蕉&#39;, &#39;桃子&#39;],</span>
<span class="line">    ordered=True</span>
<span class="line">)</span>
<span class="line">ser = pd.Series(data=sales_data, index=index)</span>
<span class="line">ser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">苹果    6</span>
<span class="line">香蕉    6</span>
<span class="line">苹果    7</span>
<span class="line">苹果    6</span>
<span class="line">桃子    8</span>
<span class="line">香蕉    6</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>基于索引分组数据，然后使用<code>sum</code>进行求和。</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">ser.groupby(level=0).sum()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">苹果    19</span>
<span class="line">香蕉    12</span>
<span class="line">桃子     8</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>指定索引的顺序。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">ser<span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">.</span>reorder_categories<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;香蕉&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;桃子&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;苹果&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">ser<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">香蕉    12</span>
<span class="line">桃子     8</span>
<span class="line">苹果    19</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多级索引" tabindex="-1"><a class="header-anchor" href="#多级索引"><span>多级索引</span></a></h3><p>Pandas 中的<code>MultiIndex</code>类型用来表示层次或多级索引。可以使用<code>MultiIndex</code>类的类方法<code>from_arrays</code>、<code>from_product</code>、<code>from_tuples</code>等来创建多级索引，我们给大家举几个例子。</p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">tuples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;blue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;blue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_tuples<span class="token punctuation">(</span>tuples<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;no&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">index</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">MultiIndex([(1,  &#39;red&#39;),</span>
<span class="line">            (1, &#39;blue&#39;),</span>
<span class="line">            (2,  &#39;red&#39;),</span>
<span class="line">            (2, &#39;blue&#39;)],</span>
<span class="line">           names=[&#39;no&#39;, &#39;color&#39;])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;blue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;blue&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line">index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>arrays<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;no&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">index</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">MultiIndex([(1,  &#39;red&#39;),</span>
<span class="line">            (1, &#39;blue&#39;),</span>
<span class="line">            (2,  &#39;red&#39;),</span>
<span class="line">            (2, &#39;blue&#39;)],</span>
<span class="line">           names=[&#39;no&#39;, &#39;color&#39;])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">sales_data <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">ser <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token operator">=</span>sales_data<span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">)</span></span>
<span class="line">ser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">no  color</span>
<span class="line">1   red      43</span>
<span class="line">    blue     31</span>
<span class="line">2   red      55</span>
<span class="line">    blue     75</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">ser<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">&#39;no&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">no</span>
<span class="line">1     74</span>
<span class="line">2    130</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">ser<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">color</span>
<span class="line">blue    106</span>
<span class="line">red      98</span>
<span class="line">dtype: int64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">stu_ids = np.arange(1001, 1006)</span>
<span class="line">semisters = [&#39;期中&#39;, &#39;期末&#39;]</span>
<span class="line">index = pd.MultiIndex.from_product((stu_ids, semisters), names=[&#39;学号&#39;, &#39;学期&#39;])</span>
<span class="line">courses = [&#39;语文&#39;, &#39;数学&#39;, &#39;英语&#39;]</span>
<span class="line">scores = np.random.randint(60, 101, (10, 3))</span>
<span class="line">df = pd.DataFrame(data=scores, columns=courses, index=index)</span>
<span class="line">df</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">             语文 数学 英语</span>
<span class="line">学号	学期			</span>
<span class="line">1001  期中	93	77	60</span>
<span class="line">      期末	93	98	84</span>
<span class="line">1002  期中	64	78	71</span>
<span class="line">      期末	70	71	97</span>
<span class="line">1003  期中	72	88	97</span>
<span class="line">      期末	99	100	63</span>
<span class="line">1004  期中	80	71	61</span>
<span class="line">      期末	91	62	72</span>
<span class="line">1005  期中	82	95	67</span>
<span class="line">      期末	84	78	86</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据第一级索引分组数据，按照期中成绩占<code>25%</code>，期末成绩占<code>75%</code> 的方式计算每个学生每门课的成绩。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">df.groupby(level=0).agg(lambda x: x.values[0] * 0.25 + x.values[1] * 0.75)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">        语文    数学    英语</span>
<span class="line">学号			</span>
<span class="line">1001	93.00	92.75	78.00</span>
<span class="line">1002	68.50	72.75	90.50</span>
<span class="line">1003	92.25	97.00	71.50</span>
<span class="line">1004	88.25	64.25	69.25</span>
<span class="line">1005	83.50	82.25	81.25</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="间隔索引" tabindex="-1"><a class="header-anchor" href="#间隔索引"><span>间隔索引</span></a></h3><p>间隔索引顾名思义是使用固定的间隔范围充当索引，我们通常会使用<code>interval_range</code>函数来创建间隔索引，代码如下所示。</p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">index <span class="token operator">=</span> pd<span class="token punctuation">.</span>interval_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">index</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">IntervalIndex([(0, 1], (1, 2], (2, 3], (3, 4], (4, 5]], dtype=&#39;interval[int64, right]&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>IntervalIndex</code>有一个名为<code>contains</code>的方法，可以检查范围内是否包含了某个元素，如下所示。</p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">index<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">array([False,  True, False, False, False])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>IntervalIndex</code>还有一个名为<code>overlaps</code>的方法，可以检查一个范围跟其他的范围是否有重叠，如下所示。</p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">index<span class="token punctuation">.</span>overlaps<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Interval<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">array([False,  True,  True,  True, False])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果希望间隔范围是左闭右开的状态，可以在创建间隔索引时通过<code>closed=&#39;left&#39;</code>来做到；如果希望两边都是关闭状态，可以将<code>close</code>参数的值赋值为<code>both</code>，代码如下所示。</p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">index <span class="token operator">=</span> pd<span class="token punctuation">.</span>interval_range<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">&#39;left&#39;</span><span class="token punctuation">)</span></span>
<span class="line">index</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">IntervalIndex([[0, 1), [1, 2), [2, 3), [3, 4), [4, 5)], dtype=&#39;interval[int64, left]&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">index <span class="token operator">=</span> pd<span class="token punctuation">.</span>interval_range<span class="token punctuation">(</span>start<span class="token operator">=</span>pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">&#39;2022-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span>pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">&#39;2022-01-04&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> closed<span class="token operator">=</span><span class="token string">&#39;both&#39;</span><span class="token punctuation">)</span></span>
<span class="line">index</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">IntervalIndex([[2022-01-01, 2022-01-02], [2022-01-02, 2022-01-03], [2022-01-03, 2022-01-04]], dtype=&#39;interval[datetime64[ns], both]&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="日期时间索引" tabindex="-1"><a class="header-anchor" href="#日期时间索引"><span>日期时间索引</span></a></h3><p><code>DatetimeIndex</code>应该是众多索引中最复杂最重要的一种索引，我们通常会使用<code>date_range()</code>函数来创建日期时间索引，该函数有几个非常重要的参数<code>start</code>、<code>end</code>、<code>periods</code>、<code>freq</code>、<code>tz</code>，分别代表起始日期时间、结束日期时间、生成周期、采样频率和时区。我们先来看看如何创建<code>DatetimeIndex</code>对象，再来讨论它的相关运算和操作，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">pd.date_range(&#39;2021-1-1&#39;, &#39;2021-6-30&#39;, periods=10)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DatetimeIndex([&#39;2021-01-01&#39;, &#39;2021-01-21&#39;, &#39;2021-02-10&#39;, &#39;2021-03-02&#39;,</span>
<span class="line">               &#39;2021-03-22&#39;, &#39;2021-04-11&#39;, &#39;2021-05-01&#39;, &#39;2021-05-21&#39;,</span>
<span class="line">               &#39;2021-06-10&#39;, &#39;2021-06-30&#39;],</span>
<span class="line">              dtype=&#39;datetime64[ns]&#39;, freq=None)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">pd.date_range(&#39;2021-1-1&#39;, &#39;2021-6-30&#39;, freq=&#39;W&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p><strong>说明</strong>：<code>freq=W</code>表示采样周期为一周，它会默认星期日是一周的开始；如果你希望星期一表示一周的开始，你可以将其修改为<code>freq=W-MON</code>；你也可以试着将该参数的值修改为<code>12H</code>，<code>M</code>，<code>Q</code>等，看看会发生什么，相信你不难猜到它们的含义。</p></blockquote><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DatetimeIndex([&#39;2021-01-03&#39;, &#39;2021-01-10&#39;, &#39;2021-01-17&#39;, &#39;2021-01-24&#39;,</span>
<span class="line">               &#39;2021-01-31&#39;, &#39;2021-02-07&#39;, &#39;2021-02-14&#39;, &#39;2021-02-21&#39;,</span>
<span class="line">               &#39;2021-02-28&#39;, &#39;2021-03-07&#39;, &#39;2021-03-14&#39;, &#39;2021-03-21&#39;,</span>
<span class="line">               &#39;2021-03-28&#39;, &#39;2021-04-04&#39;, &#39;2021-04-11&#39;, &#39;2021-04-18&#39;,</span>
<span class="line">               &#39;2021-04-25&#39;, &#39;2021-05-02&#39;, &#39;2021-05-09&#39;, &#39;2021-05-16&#39;,</span>
<span class="line">               &#39;2021-05-23&#39;, &#39;2021-05-30&#39;, &#39;2021-06-06&#39;, &#39;2021-06-13&#39;,</span>
<span class="line">               &#39;2021-06-20&#39;, &#39;2021-06-27&#39;],</span>
<span class="line">              dtype=&#39;datetime64[ns]&#39;, freq=&#39;W-SUN&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>DatatimeIndex</code>可以跟<code>DateOffset</code>类型进行运算，这一点很好理解，以为我们可以设置一个时间差让时间向前或向后偏移，具体的操作如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">index = pd.date_range(&#39;2021-1-1&#39;, &#39;2021-6-30&#39;, freq=&#39;W&#39;)</span>
<span class="line">index - pd.DateOffset(days=2)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DatetimeIndex([&#39;2021-01-01&#39;, &#39;2021-01-08&#39;, &#39;2021-01-15&#39;, &#39;2021-01-22&#39;,</span>
<span class="line">               &#39;2021-01-29&#39;, &#39;2021-02-05&#39;, &#39;2021-02-12&#39;, &#39;2021-02-19&#39;,</span>
<span class="line">               &#39;2021-02-26&#39;, &#39;2021-03-05&#39;, &#39;2021-03-12&#39;, &#39;2021-03-19&#39;,</span>
<span class="line">               &#39;2021-03-26&#39;, &#39;2021-04-02&#39;, &#39;2021-04-09&#39;, &#39;2021-04-16&#39;,</span>
<span class="line">               &#39;2021-04-23&#39;, &#39;2021-04-30&#39;, &#39;2021-05-07&#39;, &#39;2021-05-14&#39;,</span>
<span class="line">               &#39;2021-05-21&#39;, &#39;2021-05-28&#39;, &#39;2021-06-04&#39;, &#39;2021-06-11&#39;,</span>
<span class="line">               &#39;2021-06-18&#39;, &#39;2021-06-25&#39;],</span>
<span class="line">              dtype=&#39;datetime64[ns]&#39;, freq=None)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">index + pd.DateOffset(hours=2, minutes=10)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DatetimeIndex([&#39;2021-01-03 02:10:00&#39;, &#39;2021-01-10 02:10:00&#39;,</span>
<span class="line">               &#39;2021-01-17 02:10:00&#39;, &#39;2021-01-24 02:10:00&#39;,</span>
<span class="line">               &#39;2021-01-31 02:10:00&#39;, &#39;2021-02-07 02:10:00&#39;,</span>
<span class="line">               &#39;2021-02-14 02:10:00&#39;, &#39;2021-02-21 02:10:00&#39;,</span>
<span class="line">               &#39;2021-02-28 02:10:00&#39;, &#39;2021-03-07 02:10:00&#39;,</span>
<span class="line">               &#39;2021-03-14 02:10:00&#39;, &#39;2021-03-21 02:10:00&#39;,</span>
<span class="line">               &#39;2021-03-28 02:10:00&#39;, &#39;2021-04-04 02:10:00&#39;,</span>
<span class="line">               &#39;2021-04-11 02:10:00&#39;, &#39;2021-04-18 02:10:00&#39;,</span>
<span class="line">               &#39;2021-04-25 02:10:00&#39;, &#39;2021-05-02 02:10:00&#39;,</span>
<span class="line">               &#39;2021-05-09 02:10:00&#39;, &#39;2021-05-16 02:10:00&#39;,</span>
<span class="line">               &#39;2021-05-23 02:10:00&#39;, &#39;2021-05-30 02:10:00&#39;,</span>
<span class="line">               &#39;2021-06-06 02:10:00&#39;, &#39;2021-06-13 02:10:00&#39;,</span>
<span class="line">               &#39;2021-06-20 02:10:00&#39;, &#39;2021-06-27 02:10:00&#39;],</span>
<span class="line">              dtype=&#39;datetime64[ns]&#39;, freq=None)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果<code>Series</code>对象或<code>DataFrame</code>对象使用了<code>DatetimeIndex</code>类型的索引，此时我们可以通过<code>asfreq()</code>方法指定一个时间频率来实现对数据的抽样，我们仍然以之前讲过的百度股票数据为例，给大家做一个演示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">baidu_df = pd.read_excel(&#39;data/2022年股票数据.xlsx&#39;, sheet_name=&#39;BIDU&#39;, index_col=&#39;Date&#39;)</span>
<span class="line">baidu_df.sort_index(inplace=True)</span>
<span class="line">baidu_df.asfreq(&#39;5D&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+l+`" alt="baidu_stock_asfreq.png"></p><p>大家可能注意到了，每5天抽取1天有可能会抽中非交易日，那么对应的列都变成了空值，为了解决这个问题，在使用<code>asfreq</code>方法时可以通过<code>method</code>参数来指定一种填充空值的方法，可以将相邻的交易日的数据填入进来。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">baidu_df.asfreq(&#39;5D&#39;, method=&#39;ffill&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+t+`" alt="baidu_stock_asfreq_ffill.png"></p><p>当使用<code>DatetimeIndex</code>索引时，我们也可以通过<code>resample()</code>方法基于时间对数据进行重采样，相当于根据时间周期对数据进行了分组操作，分组之后还可以进行聚合统计，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">baidu_df.resample(&#39;1M&#39;).mean()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+p+`" alt="baidu_stock_resample.png"></p><p>代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">baidu_df<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">&#39;1M&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;mean&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;std&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+d+`" alt="baidu_stock_resample_agg.png"></p><blockquote><p><strong>提示</strong>：不知大家是否注意到，上面输出的<code>DataFrame</code> 的列索引是一个<code>MultiIndex</code>对象。你可以访问上面的<code>DataFrame</code>对象的<code>columns</code>属性看看。</p></blockquote><p>如果要实现日期时间的时区转换，我们可以先用<code>tz_localize()</code>方法将日期时间本地化，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">baidu_df = baidu_df.tz_localize(&#39;Asia/Chongqing&#39;)</span>
<span class="line">baidu_df</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+c+`" alt="baidu_stock_tz_localize.png"></p><p>在对时间本地化以后，我们再使用<code>tz_convert()</code>方法就可以实现转换时区，代码如下所示。</p><p>代码：</p><div class="language-Python line-numbers-mode" data-highlighter="prismjs" data-ext="Python" data-title="Python"><pre><code><span class="line">baidu_df.tz_convert(&#39;America/New_York&#39;)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出：</p><p><img src="`+r+'" alt="baidu_stock_tz_convert.png"></p><p>如果你的数据使用了<code>DatetimeIndex</code>类型的索引，那么你就很有可能要对数据进行时间序列分析，关于时间序列分析的方法和模型并不是本章节要探讨的内容，我们在其他的专栏中为大家分享。</p>',129)]))}const b=s(o,[["render",u],["__file","77.深入浅出pandas-6.html.vue"]]),h=JSON.parse('{"path":"/Day66-80/77.%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BApandas-6.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"深入浅出pandas-6","slug":"深入浅出pandas-6","link":"#深入浅出pandas-6","children":[{"level":3,"title":"范围索引","slug":"范围索引","link":"#范围索引","children":[]},{"level":3,"title":"分类索引","slug":"分类索引","link":"#分类索引","children":[]},{"level":3,"title":"多级索引","slug":"多级索引","link":"#多级索引","children":[]},{"level":3,"title":"间隔索引","slug":"间隔索引","link":"#间隔索引","children":[]},{"level":3,"title":"日期时间索引","slug":"日期时间索引","link":"#日期时间索引","children":[]}]}],"git":{"updatedTime":null,"contributors":[]},"filePathRelative":"Day66-80/77.深入浅出pandas-6.md"}');export{b as comp,h as data};
